
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://courses.mlops.vn/mlops-crash-course/data-pipeline/xay-dung-data-pipeline.html" rel="canonical"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.1, mkdocs-material-8.4.1" name="generator"/>
<title>Xây dựng pipeline - MLOpsVN Courses</title>
<link href="../../assets/stylesheets/main.69437709.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<meta content="#4cae4f" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/stylesheets/styles.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JX2MD05JFT"),document.addEventListener("DOMContentLoaded",function(){if(document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document.forms.feedback){var e,a=document.forms.feedback;for(e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}"undefined"!=typeof location$&&location$.subscribe(function(e){n("config","G-JX2MD05JFT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JX2MD05JFT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>html.glightbox-open { overflow: initial; height: 100%; }</style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="green" data-md-color-primary="green" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#gioi-thieu">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="MLOpsVN Courses" class="md-header__button md-logo" data-md-component="logo" href="../../index.html" title="MLOpsVN Courses">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            MLOpsVN Courses
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Xây dựng pipeline
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="MLOpsVN Courses" class="md-nav__button md-logo" data-md-component="logo" href="../../index.html" title="MLOpsVN Courses">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    MLOpsVN Courses
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../index.html">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../index.html">MLOps Crash Course</a>
<label for="__nav_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="MLOps Crash Course" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          MLOps Crash Course
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1">
          Tổng quan hệ thống
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Tổng quan hệ thống" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
          Tổng quan hệ thống
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../tong-quan-he-thong/tong-quan-mlops.html">
        Tổng quan MLOps
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tong-quan-he-thong/phan-tich-van-de.html">
        Phân tích vấn đề
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tong-quan-he-thong/mlops-platform.html">
        MLOps platform
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../poc/xay-dung-poc.html">
        POC
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
          Data pipeline
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Data pipeline" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Data pipeline
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="tong-quan-data-pipeline.html">
        Tổng quan pipeline
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="airflow-co-ban.html">
        Airflow cơ bản
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="feature-store.html">
        Feature store
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Xây dựng pipeline
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="xay-dung-data-pipeline.html">
        Xây dựng pipeline
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gioi-thieu">
    Giới thiệu
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#moi-truong-phat-trien">
    Môi trường phát triển
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cac-tuong-tac-chinh-voi-feast">
    Các tương tác chính với Feast
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xay-dung-cac-pipelines">
    Xây dựng các pipelines
  </a>
<nav aria-label="Xây dựng các pipelines" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#etl-pipeline">
    ETL pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feast-materialize-pipeline">
    Feast materialize pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stream-pipeline">
    Stream pipeline
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tong-ket">
    Tổng kết
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tai-lieu-tham-khao">
    Tài liệu tham khảo
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../training-pipeline/xay-dung-training-pipeline.html">
        Training pipeline
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model-serving/trien-khai-model-serving.html">
        Model serving
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Monitoring" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/tong-quan-monitoring.html">
        Tổng quan monitoring
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/metrics-he-thong.html">
        Metrics hệ thống
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/thiet-ke-monitoring-service.html">
        Thiết kế monitoring service
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../monitoring/trien-khai-monitoring-service.html">
        Triển khai monitoring service
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7">
          CI/CD
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CI/CD" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
          CI/CD
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/gioi-thieu.html">
        Giới thiệu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/kiem-thu-he-thong.html">
        Kiểm thử hệ thống
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/jenkins-co-ban.html">
        Jenkins cơ bản
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/data-pipeline.html">
        CI/CD cho data pipeline
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ci-cd/model-serving.html">
        CI/CD cho model serving
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tong-ket/tom-tat-noi-dung.html">
        Tổng kết
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CONTRIBUTING.html">
        Contributing
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../CODE_OF_CONDUCT.html">
        Code of Conduct
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gioi-thieu">
    Giới thiệu
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#moi-truong-phat-trien">
    Môi trường phát triển
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cac-tuong-tac-chinh-voi-feast">
    Các tương tác chính với Feast
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xay-dung-cac-pipelines">
    Xây dựng các pipelines
  </a>
<nav aria-label="Xây dựng các pipelines" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#etl-pipeline">
    ETL pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#feast-materialize-pipeline">
    Feast materialize pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stream-pipeline">
    Stream pipeline
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tong-ket">
    Tổng kết
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tai-lieu-tham-khao">
    Tài liệu tham khảo
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Xây dựng pipeline</h1>
<figure>
<a class="glightbox" href="../../assets/images/mlops-crash-course/data-pipeline/pipeline-everywhere.jpeg"><img loading="lazy" src="../../assets/images/mlops-crash-course/data-pipeline/pipeline-everywhere.jpeg"/></a>
<figcaption>Photo by <a href="https://snehamehrin22.medium.com/?source=post_page-----fe14643c67fd--------------------------------">Sneha Mehrin</a> on <a href="https://snehamehrin22.medium.com/how-to-build-a-technical-design-architecture-for-an-analytics-data-pipeline-fe14643c67fd">Medium</a></figcaption>
</figure>
<h2 id="gioi-thieu">Giới thiệu</h2>
<p>Ở bài học trước, chúng ta đã làm quen với feature store, Feast và dùng command <code>feast apply</code> để tạo ra feature definition ở đường dẫn <code>data_pipeline/feature_repo/registry/local_registry.db</code>. Trong bài học này chúng ta sẽ sử dụng folder này để cấu hình client <code>store</code> giao tiếp với feature store như sau:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">feast</span> <span class="kn">import</span> <span class="n">FeatureStore</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">store</span> <span class="o">=</span> <span class="n">FeatureStore</span><span class="p">(</span><span class="n">repo_path</span><span class="o">=</span><span class="s2">"../feature_repo"</span><span class="p">)</span>  <span class="c1"># (1)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>Khởi tạo client <em>store</em> để giao tiếp với feature store</li>
</ol>
<p>Client này sẽ được sử dụng ở nhiều bước khác nhau bao gồm <strong>1</strong>, <strong>2</strong>, <strong>3</strong>, <strong>4</strong>, <strong>5</strong> như hình dưới đây:</p>
<p><a class="glightbox" href="../../assets/images/mlops-crash-course/data-pipeline/Feast_architecture.png"><img loading="lazy" src="../../assets/images/mlops-crash-course/data-pipeline/Feast_architecture.png"/></a></p>
<h2 id="moi-truong-phat-trien">Môi trường phát triển</h2>
<p>Ngoài Feast, bài học này sẽ sử dụng thêm Airflow, bạn vào repo <code>mlops-crash-course-platform/</code> và start service này như sau:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>bash run.sh airflow up
</code></pre></div>
<h2 id="cac-tuong-tac-chinh-voi-feast">Các tương tác chính với Feast</h2>
<p>Chúng ta có 6 tương tác chính với Feast như sau:</p>
<p>1. Materialize feature từ offline sang online store để đảm bảo online store lưu trữ feature mới nhất</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/scripts/feast_helper.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">cd</span> <span class="n">feature_repo</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">feast</span> <span class="n">materialize</span><span class="o">-</span><span class="n">incremental</span> <span class="err">$</span><span class="p">(</span><span class="n">date</span> <span class="o">+%</span><span class="n">Y</span><span class="o">-%</span><span class="n">m</span><span class="o">-%</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Để hiểu rõ hơn về <code>materialize</code>, giả sử rằng ở offline store chúng ta có 3 record của ID 1001 như sau:</p>
<table>
<thead>
<tr>
<th>datetime</th>
<th>driver_id</th>
<th>conv_rate</th>
<th>acc_rate</th>
<th>avg_daily_trips</th>
<th>created</th>
</tr>
</thead>
<tbody>
<tr>
<td>2021-07-13 11:00:00+00:00</td>
<td>1001</td>
<td>0.852406</td>
<td>0.059147</td>
<td>340</td>
<td>2021-07-28 11:08:04.802</td>
</tr>
<tr>
<td>2021-08-10 12:00:00+00:00</td>
<td>1001</td>
<td>0.571599</td>
<td>0.244896</td>
<td>752</td>
<td>2021-07-28 11:08:04.802</td>
</tr>
<tr>
<td>2021-07-13 13:00:00+00:00</td>
<td>1001</td>
<td>0.929023</td>
<td>0.479821</td>
<td>716</td>
<td>2021-07-28 11:08:04.802</td>
</tr>
</tbody>
</table>
<p>Khi chúng ta chạy command <code>feast materialize 2021-08-07T00:00:00</code>, thì dữ liệu có <code>datetime</code> mới nhất mà trước thời điểm <code>2021-08-07T00:00:00</code> sẽ được cập nhật vào online store. Đó chính là record <strong>thứ 3</strong> ở bảng trên.</p>
<table>
<thead>
<tr>
<th>datetime</th>
<th>driver_id</th>
<th>conv_rate</th>
<th>acc_rate</th>
<th>avg_daily_trips</th>
<th>created</th>
</tr>
</thead>
<tbody>
<tr>
<td>2021-07-13 13:00:00+00:00</td>
<td>1001</td>
<td>0.929023</td>
<td>0.479821</td>
<td>716</td>
<td>2021-07-28 11:08:04.802</td>
</tr>
</tbody>
</table>
</details>
<p>2. Data scientist, training pipeline hoặc offline batch serving pipeline kéo features về để train model</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/examples/get_historical_features.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">entity_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="p">{</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>        <span class="s2">"driver_id"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">],</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>        <span class="s2">"datetime"</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>            <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">),</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>            <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>            <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="p">],</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="p">}</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="n">training_df</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get_historical_features</span><span class="p">(</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="n">entity_df</span><span class="o">=</span><span class="n">entity_df</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">"driver_stats:acc_rate"</span><span class="p">,</span> <span class="s2">"driver_stats:conv_rate"</span><span class="p">],</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">()</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">training_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>3. Kéo features mới nhất tương ứng với các IDs trong request API để cho qua model dự đoán</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/examples/get_online_features.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get_online_features</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="n">features</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>        <span class="s2">"driver_stats:acc_rate"</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>        <span class="s2">"driver_stats:conv_rate"</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="p">],</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="n">entity_rows</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>            <span class="s2">"driver_id"</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="p">}</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="p">],</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">include_event_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="k">def</span> <span class="nf">print_online_features</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">" : "</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="n">print_online_features</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>4. Đẩy stream feature vào offline store</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/src/stream_to_stores/processor.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span> <span class="nf">preprocess_fn</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"df columns: </span><span class="si">{</span><span class="n">rows</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"df size: </span><span class="si">{</span><span class="n">rows</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"df preview:</span><span class="se">\n</span><span class="si">{</span><span class="n">rows</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="k">return</span> <span class="n">rows</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="n">ingestion_config</span> <span class="o">=</span> <span class="n">SparkProcessorConfig</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">"spark"</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">"kafka"</span><span class="p">,</span> <span class="n">spark_session</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span> <span class="n">processing_time</span><span class="o">=</span><span class="s2">"30 seconds"</span><span class="p">,</span> <span class="n">query_timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="n">sfv</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">get_stream_feature_view</span><span class="p">(</span><span class="s2">"driver_stats_stream"</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="n">processor</span> <span class="o">=</span> <span class="n">get_stream_processor_object</span><span class="p">(</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="n">config</span><span class="o">=</span><span class="n">ingestion_config</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="n">fs</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="n">sfv</span><span class="o">=</span><span class="n">sfv</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="n">preprocess_fn</span><span class="o">=</span><span class="n">preprocess_fn</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="p">)</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="n">processor</span><span class="o">.</span><span class="n">ingest_stream_feature_view</span><span class="p">(</span><span class="n">PushMode</span><span class="o">.</span><span class="n">OFFLINE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>5. Đẩy stream feature vào online store</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">processor</span><span class="o">.</span><span class="n">ingest_stream_feature_view</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>7. ETL (Extract, Transform, Load) pipeline cập nhật dữ liệu của offline store</p>
<details class="tip" open="open">
<summary>Tip</summary>
<p>Ở tương tác 2., thông thường các Data Scientist sẽ kéo dữ liệu từ feature store để:</p>
<ul>
<li>thực hiện POC</li>
<li>thử nghiệm với các feature khác nhằm mục đích cải thiện model</li>
</ul>
</details>
<p>Ở công đoạn xây dựng data pipeline, chúng ta sẽ xây dựng pipeline cho các tương tác 1., 4., 5., 7.</p>
<h2 id="xay-dung-cac-pipelines">Xây dựng các pipelines</h2>
<h3 id="etl-pipeline">ETL pipeline</h3>
<p>Để tạo ra một Airflow pipeline, thông thường chúng ta sẽ làm theo trình tự sau:</p>
<ol>
<li>Định nghĩa <em>DAG</em> cho pipeline (line 1-8)</li>
<li>Viết các task cho pipeline, ví dụ: <em>ingest_task</em>, <em>clean_task</em> và <em>explore_and_validate_task</em> (line 9-25)</li>
<li>Viết thứ tự chạy các task (line 27)</li>
<li>
<p>Chạy lệnh sau để build Docker image cho các pipeline component, và copy file code DAG sang folder <code>airflow/run_env/dags/data_pipeline</code> của repo clone từ <a href="https://github.com/MLOpsVN/mlops-crash-course-platform">MLOps Crash course platform</a></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nb">cd</span> data_pipeline
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>make build_image
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="c1"># Đảm bảo Airflow server đã chạy</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>make deploy_dags <span class="c1"># (1)</span>
</code></pre></div>
<ol>
<li>Copy <code>data_pipeline/dags/*</code> vào folder <code>dags</code> của Airflow</li>
</ol>
<p>DAG dưới đây thể hiện ETL pipeline.</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/dags/db_to_offline_store.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="n">dag_id</span><span class="o">=</span><span class="s2">"db_to_offline_store"</span><span class="p">,</span> <span class="c1"># (1)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span class="n">default_args</span><span class="o">=</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DAG_ARGS</span><span class="p">,</span> <span class="c1"># (2)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="n">schedule_interval</span><span class="o">=</span><span class="s2">"@once"</span><span class="p">,</span>  <span class="c1"># (3)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">pendulum</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"UTC"</span><span class="p">),</span> <span class="c1"># (4)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>    <span class="n">catchup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># (5)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">"data_pipeline"</span><span class="p">],</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">)</span> <span class="k">as</span> <span class="n">dag</span><span class="p">:</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>    <span class="n">ingest_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"ingest_task"</span><span class="p">,</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash -c 'cd src/db_to_offline_store &amp;&amp; python ingest.py'"</span><span class="p">,</span>  <span class="c1"># (6)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="p">)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="n">clean_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"clean_task"</span><span class="p">,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash -c 'cd src/db_to_offline_store &amp;&amp; python clean.py'"</span><span class="p">,</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>    <span class="p">)</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>    <span class="n">explore_and_validate_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"explore_and_validate_task"</span><span class="p">,</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash -c 'cd src/db_to_offline_store &amp;&amp; python explore_and_validate.py'"</span><span class="p">,</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>    <span class="p">)</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>    <span class="n">ingest_task</span> <span class="o">&gt;&gt;</span> <span class="n">clean_task</span> <span class="o">&gt;&gt;</span> <span class="n">explore_and_validate_task</span>  <span class="c1"># (7)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>Định nghĩa tên pipeline hiển thị ở trên Airflow dashboard</li>
<li>Định nghĩa pipeline owner, số lần retry pipeline, và khoảng thời gian giữa các lần retry</li>
<li>Lịch chạy pipeline, ở đây <code>@once</code> là một lần chạy, bạn có thể thay bằng cron expression ví dụ như 0 0 1 * *</li>
<li>Ngày bắt đầu chạy pipeline theo múi giờ UTC</li>
<li>Nếu <strong>start_date</strong> là ngày 01/01/2022, ngày deploy/turn on pipeline là ngày 02/02/2022, và <strong>schedule_interval</strong> là @daily thì sẽ không chạy các ngày trước 02/02/2022 nữa</li>
<li>Command chạy trong docker container cho bước này</li>
<li>Định nghĩa thứ tự chạy các bước của pipeline: đầu tiên là <strong>ingest</strong> sau đó tới <strong>clean</strong> và cuối cùng là <strong>explore_and_validate</strong></li>
</ol>
<details class="info" open="open">
<summary>Info</summary>
<p>Do chúng ta dùng DockerOperator để tạo <em>task</em> nên cần phải build image chứa code và môi trường trước, sau đó sẽ truyền tên image vào <code>DEFAULT_DOCKER_OPERATOR_ARGS</code> trong từng pipeline component (ví dụ như line 11). Dockerfile để build image bạn có thể tham khảo tại <code>data_pipeline/deployment/Dockerfile</code></p>
</details>
<p>Biến <code>DefaultConfig.DEFAULT_DOCKER_OPERATOR_ARGS</code> chứa các config như sau:</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/dags/utils.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="s2">"image"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">AppConst</span><span class="o">.</span><span class="n">DOCKER_USER</span><span class="si">}</span><span class="s2">/mlops_crash_course/data_pipeline:latest"</span><span class="p">,</span> <span class="c1"># (1)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span class="s2">"api_version"</span><span class="p">:</span> <span class="s2">"auto"</span><span class="p">,</span>  <span class="c1"># (2)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span class="s2">"auto_remove"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># (3)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="s2">"mounts"</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>        <span class="n">Mount</span><span class="p">(</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>            <span class="n">source</span><span class="o">=</span><span class="n">AppPath</span><span class="o">.</span><span class="n">FEATURE_REPO</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span> <span class="c1"># (4)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>            <span class="n">target</span><span class="o">=</span><span class="s2">"/data_pipeline/feature_repo"</span><span class="p">,</span> <span class="c1"># (5)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>            <span class="nb">type</span><span class="o">=</span><span class="s2">"bind"</span><span class="p">,</span> <span class="c1"># (6)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>        <span class="p">),</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>    <span class="p">],</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>Docker image dùng cho task</li>
<li>Tự động xác định Docker engine API version</li>
<li>Tự động dọn dẹp container sau khi exit</li>
<li>Folder ở máy local, bắt buộc là đường dẫn tuyệt đối</li>
<li>Folder nằm trong docker container</li>
<li>Kiểu bind, đọc thêm <a href="https://docs.docker.com/storage/#choose-the-right-type-of-mount">ở đây</a></li>
</ol>
</li>
<li>
<p>Đăng nhập vào Airflow tại <a href="http://localhost:8088">http://localhost:8088</a>, account <code>airflow</code>, password <code>airflow</code>, các bạn sẽ thấy một DAG với tên <em>db_to_offline_store</em>, 2 DAG bên dưới chính là những pipeline còn lại trong data pipelines (đề cập ở bên dưới).</p>
<p><a class="glightbox" href="../../assets/images/mlops-crash-course/data-pipeline/airflow1.png"><img loading="lazy" src="../../assets/images/mlops-crash-course/data-pipeline/airflow1.png"/></a></p>
</li>
<li>
<p>Đặt Airflow Variable <code>MLOPS_CRASH_COURSE_CODE_DIR</code> bằng đường dẫn tuyệt đối tới folder <code>mlops-crash-course-code/</code>. Tham khảo <a href="https://airflow.apache.org/docs/apache-airflow/stable/howto/variable.html">hướng dẫn này</a> về cách đặt Airflow Variable.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Airflow Variable <code>MLOPS_CRASH_COURSE_CODE_DIR</code> được dùng trong file <code>data_pipeline/dags/utils.py</code>. Variable này chứa đường dẫn tuyệt đối tới folder <code>mlops-crash-course-code/</code>, vì <code>DockerOperator</code> yêu cầu <code>Mount Source</code> phải là đường dẫn tuyệt đối.</p>
</div>
</li>
<li>
<p>Kích hoạt data pipeline và đợi kết quả</p>
<p><a class="glightbox" href="../../assets/images/mlops-crash-course/data-pipeline/airflow4.png"><img loading="lazy" src="../../assets/images/mlops-crash-course/data-pipeline/airflow4.png"/></a></p>
</li>
<li>
<p>Xem thứ tự các task của pipeline này như sau:</p>
<p><a class="glightbox" href="../../assets/images/mlops-crash-course/data-pipeline/airflow2.png"><img loading="lazy" src="../../assets/images/mlops-crash-course/data-pipeline/airflow2.png"/></a></p>
</li>
</ol>
<p>Tương tự như ETL pipeline, chúng ta sẽ code tiếp <em>Feast materialize pipeline</em> và <em>Stream to stores pipeline</em> như bên dưới.</p>
<h3 id="feast-materialize-pipeline">Feast materialize pipeline</h3>
<p>Materialize dữ liệu từ <em>offline</em> qua <em>online</em> giúp làm mới dữ liệu ở <em>online store</em></p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/dags/materialize_offline_to_online.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="n">dag_id</span><span class="o">=</span><span class="s2">"materlize_offline_to_online"</span><span class="p">,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="n">default_args</span><span class="o">=</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DAG_ARGS</span><span class="p">,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="n">schedule_interval</span><span class="o">=</span><span class="s2">"@once"</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">pendulum</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"UTC"</span><span class="p">),</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="n">catchup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">"data_pipeline"</span><span class="p">],</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="p">)</span> <span class="k">as</span> <span class="n">dag</span><span class="p">:</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="n">materialize_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"materialize_task"</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash ./scripts/feast_helper.sh materialize"</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="stream-pipeline">Stream pipeline</h3>
<p>Trong phần này, chúng ta sẽ làm mới features bằng cách ghi dữ liệu trực tiếp từ stream source vào <em>offline</em> và <em>online store</em>.</p>
<p>Ở bài trước, chúng ta đã chạy Kafka stream. Đoạn code dưới đây sẽ thực hiện tác vụ đọc và xử lý data từ Kafka stream và lưu vào offline store và online store. Khi bạn sử dụng thư viện Feast trong đoạn code training hay inference để đọc features, bạn sẽ thấy features được cập nhật mới liên tục. Các đoạn code training và inference này sẽ được hướng dẫn trong các bài tiếp theo.</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">data_pipeline/dags/stream_to_stores.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="n">dag_id</span><span class="o">=</span><span class="s2">"stream_to_stores"</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span class="n">default_args</span><span class="o">=</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DAG_ARGS</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>    <span class="n">schedule_interval</span><span class="o">=</span><span class="s2">"@once"</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">pendulum</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"UTC"</span><span class="p">),</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>    <span class="n">catchup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">"data_pipeline"</span><span class="p">],</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="p">)</span> <span class="k">as</span> <span class="n">dag</span><span class="p">:</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>    <span class="n">stream_to_online_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"stream_to_online_task"</span><span class="p">,</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash -c 'cd src/stream_to_stores &amp;&amp; python ingest.py --store online'"</span><span class="p">,</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>    <span class="p">)</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>    <span class="n">stream_to_offline_task</span> <span class="o">=</span> <span class="n">DockerOperator</span><span class="p">(</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>        <span class="n">task_id</span><span class="o">=</span><span class="s2">"stream_to_offline_task"</span><span class="p">,</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>        <span class="o">**</span><span class="n">DefaultConfig</span><span class="o">.</span><span class="n">DEFAULT_DOCKER_OPERATOR_ARGS</span><span class="p">,</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>        <span class="n">command</span><span class="o">=</span><span class="s2">"/bin/bash -c 'cd src/stream_to_stores &amp;&amp; python ingest.py --store offline'"</span><span class="p">,</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="tong-ket">Tổng kết</h2>
<p>Ở bài học này, chúng ta đã sử dụng Feast SDK để lưu trữ và lấy feature từ feature store. Để đảm bảo feature luôn ở trạng thái mới nhất có thể, chúng ta cũng đã xây dựng các Airflow pipeline để cập nhật dữ liệu định kỳ cho các store.</p>
<p>Chúng ta cũng hoàn thành chuỗi bài về data pipeline, hy vọng bạn có thể vận dụng các kiến thức đã học để vận hành hiệu quả các luồng dữ liệu và luồng feature của mình.</p>
<h2 id="tai-lieu-tham-khao">Tài liệu tham khảo</h2>
<ul>
<li><a href="https://feast.dev/">https://feast.dev/</a></li>
<li><a href="https://airflow.apache.org/docs/apache-airflow/stable/tutorial/index.html">https://airflow.apache.org/docs/apache-airflow/stable/tutorial/index.html</a></li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Feature store" class="md-footer__link md-footer__link--prev" href="feature-store.html" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Feature store
            </div>
</div>
</a>
<a aria-label="Next: Training pipeline" class="md-footer__link md-footer__link--next" href="../training-pipeline/xay-dung-training-pipeline.html" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Training pipeline
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright 2022 MLOpsVN Community. All Rights Reserved. Licensed under the Creative Commons Attribution 4.0 International Public License
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/mlopsvn/courses.mlops.vn" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "width": "100%", "height": "auto", "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>